# BackOffice Launcher (PyQt6)

Простое настольное приложение, разработанное на Python с использованием фреймворка PyQt6, предназначенное для упрощения запуска бэк-офисов iiko/Syrve и подключения к удаленным рабочим столам (AnyDesk, LiteManager) на основе введенного пользователем адреса или ID.

## Возможности

*   **Запуск BackOffice:** Запуск iikoRMS/Chain или SyrveRMS/Chain по URL или IP:порту.
    *   Автоматическое получение информации о сервере (версия, состояние).
    *   Поиск, скачивание и подготовка нужной версии дистрибутива.
    *   Автоматическое редактирование файла `backclient.config.xml` с правильными данными подключения и логином по умолчанию из конфигурации приложения.
    *   Запуск BackOffice с настроенным конфигом.
*   **Подключение через AnyDesk:** Запуск клиента AnyDesk с указанным ID.
    *   Автоматическое определение AnyDesk ID во введенной строке.
    *   Запрос пароля для подключения через диалоговое окно.
    *   **Опциональная очистка кэша Anydesk:** Удаление папки `%appdata%\AnyDesk\` при запуске AnyDesk flow с удержанием клавиши `Ctrl` (только если процесс Anydesk не запущен).
*   **Подключение через LiteManager:** Запуск клиента LiteManager Viewer с указанным ID.
    *   Определение LiteManager ID во введенной строке по настраиваемой маске.
    *   Запрос пароля для подключения через диалоговое окно.
*   **Интуитивно понятный интерфейс:** Простой графический интерфейс с полем ввода, кнопками, индикатором прогресса и областью вывода статуса/ошибок.
*   **Настраиваемые источники дистрибутивов:** Возможность настроить приоритетные источники для скачивания дистрибутивов (SMB, HTTP, FTP).
*   **Логирование:** Подробное логирование работы приложения (в консоль и файл).

## Как пользоваться

1.  **Скачайте приложение:** Загрузите исполняемый файл `BackOfficeLauncher.exe` из раздела [Releases](https://github.com/serty2005/BOlauncherQT/releases/latest/download/BackOfficeLauncher.exe).
2.  **Разместите файлы:** Поместите скачанный `BackOfficeLauncher.exe` и файл `config.ini` (будет создан при первом запуске, если отсутствует) в одну папку. Если вы используете иконку, убедитесь, что файл `icon.ico` также находится в этой папке или в пути, указанном в коде.
3.  **Настройте `config.ini` (опционально):** При первом запуске будет создан файл `config.ini` со значениями по умолчанию. Вы можете отредактировать его для изменения:
    *   `[Settings]`:
        *   `InstallerRoot`: Путь к папке, где будут храниться скачанные дистрибутивы BackOffice.
        *   `DefaultLogin`: Логин, который будет автоматически записываться в `backclient.config.xml`.
        *   `AnyDeskPath`: Полный путь к исполняемому файлу `AnyDesk.exe`.
        *   `LiteManagerPath`: Полный путь к исполняемому файлу `ROMViewer.exe` (LiteManager Viewer).
        *   `LiteManagerIdMask`: Маска для определения ID LiteManager во введенной строке (символ `1` в маске соответствует любой цифре). Пример: `MH_11111` или `1111111`.
        *   `DebugLogging`: `True` для включения подробного логирования в файл `debug_log.log` рядом с `.exe`.
    *   `[SourcePriority]`: Определяет порядок, в котором приложение будет искать или скачивать дистрибутивы (например, `smb, http, ftp`).
    *   `[SmbSource]`, `[HttpSource]`, `[FtpSource]`: Настройки для каждого источника дистрибутивов.
4.  **Запустите приложение:** Запустите `BackOfficeLauncher.exe`.
5.  **Введите данные:** Введите в текстовое поле:
    *   URL или IP:порт сервера iiko/Syrve (например, `server.example.com`, `192.168.1.100:8080`, `https://sub.domain.iiko.it`).
    *   AnyDesk ID (9 или 10 цифр, можно с пробелами, например, `123456789`, `123 456 7890`, `1 713 600 595`).
    *   LiteManager ID (в формате, соответствующем маске из `config.ini`, например, `MH_12345`).
6.  **Выберите действие:**
    *   Нажмите кнопку **"Launch"** (или `Enter` в поле ввода) для запуска соответствующего процесса (BackOffice, AnyDesk, LiteManager).
        *   Если введен AnyDesk ID, появится диалог для ввода пароля.
        *   Если введен LiteManager ID, появится диалог для ввода пароля.
        *   Если введен адрес сервера, запустится процесс подготовки и запуска BackOffice.
    *   Нажмите кнопку **"Check"** для получения информации о сервере (работает только для URL/IP:порт, при вводе ID удаленного доступа выведет "Херню спросил").
    *   Нажмите кнопку **"Paste"** для вставки содержимого из буфера обмена в поле ввода.
    *   Нажмите кнопку **"Abort"** для прерывания текущей операции (запуска BackOffice или проверки сервера).
7.  **Особые действия:**
    *   **Ctrl + Launch (или Ctrl + Enter в поле ввода):** Если введен AnyDesk ID и процесс Anydesk *не* запущен, перед запросом пароля будет выполнена очистка папки кэша AnyDesk (`%appdata%\AnyDesk\`).

## Структура кода (для разработчиков)

Проект разделен на несколько модулей:

*   `main.py`: Точка входа в приложение. Загружает конфигурацию, настраивает логирование, создает главное окно GUI и запускает цикл событий приложения.
*   `core/`: Содержит основную логику приложения.
    *   `config.py`: Управление конфигурацией приложения (`config.ini`).
    *   `launcher.py`: Шаги последовательности запуска BackOffice (парсинг, HTTP-запрос, обработка ответа, очистка AppData и т.д.).
    *   `installer.py`: Логика поиска, скачивания и подготовки дистрибутивов BackOffice с разных источников.
    *   `downloader.py`: Функции для скачивания файлов по HTTP, FTP и SMB.
*   `gui/`: Содержит элементы графического интерфейса.
    *   `main_window.py`: Класс главного окна приложения, обрабатывает взаимодействие с пользователем и запускает задачи в рабочих потоках.
*   `utils/`: Вспомогательные утилиты.
    *   `file_utils.py`: Функции для работы с файлами (ожидание, редактирование XML, получение метаданных).
    *   `process_utils.py`: Функции для работы с процессами (остановка, проверка запущенности).
    *   `url_utils.py`: Функции для парсинга входных строк (URL, IP:порт, ID удаленного доступа).
    *   `anydesk_utils.py`: Функции для запуска AnyDesk.
    *   `litemanager_utils.py`: Функции для запуска LiteManager.
    *   `exceptions.py`: Пользовательские исключения.
*   `workers/`: Модули с классами воркеров (`QObject`), которые выполняют длительные операции в отдельных потоках, чтобы не блокировать основной поток GUI.
*   `icon.ico`: Файл иконки приложения.
*   `requirements.txt`: Список зависимостей Python.

## Вклад

Приветствуются любые предложения и улучшения! Пожалуйста, создавайте Issue для сообщений об ошибках или предложений, и Pull Requests для внесения изменений.

## Лицензия

[Укажите здесь тип лицензии, например MIT]
